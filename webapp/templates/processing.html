<!DOCTYPE html>
<html>
<head>
    <title>Processing</title>
</head>
<body>
<h2>Видео анализируется</h2>
<p>Job ID: {{ job_id }}</p>
<p id="status">Проверяем статус...</p>

<script>
async function poll() {
    try {
        const res = await fetch("/api/jobs/{{ job_id }}");
        const data = await res.json();

        if (!data.ok) return;

        const status = data.job.status;
        document.getElementById("status").innerText = "Статус: " + status;

        if (status === "done") {
            window.location.href = "/result/{{ job_id }}";
            return;
        }

        if (status === "failed") {
            document.getElementById("status").innerText = "Ошибка обработки";
            return;
        }

        setTimeout(poll, 2000);
    } catch {
        setTimeout(poll, 3000);
    }
}

poll();
</script>
</body>
</html>
